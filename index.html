<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>上海伊莱美医疗美容医院</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
  	<link href="favicon.ico" rel="SHORTCUT ICON">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/zepto.min.js"></script>
    <script src="js/touch.js"></script>
    <script src="js/base.js"></script>
</head>
<body>
    <header class="dt-header">
        <ul class="clearfix">
            <li class="dt-tg dt-tg-ont tg-act">
                <span class="span-first"><span class="dt-month"></span>-<span class="dt-day"></span></span>
                <span>星期<span class="dt-week"></span></span>
            </li>
            <li class="dt-tg dt-tg-append">
                <span><span class="dt-month"></span>-<span class="dt-day"></span></span>
                <span>星期<span class="dt-week"></span></span>
            </li>
            <li class="dt-tg dt-tg-append">
                <span><span class="dt-month"></span>-<span class="dt-day"></span></span>
                <span>星期<span class="dt-week"></span></span>
            </li>
            <li class="dt-tg dt-tg-append">
                <span><span class="dt-month"></span>-<span class="dt-day"></span></span>
                <span>星期<span class="dt-week"></span></span>
            </li>
            <li class="dt-tg dt-tg-append">
                <span><span class="dt-month"></span>-<span class="dt-day"></span></span>
                <span>星期<span class="dt-week"></span></span>
            </li>
        </ul>
    </header>
    <section class="dt-main">
        <ul class="clearfix">
            <li class="dt-hour">09:00</li>
            <li class="dt-hour">10:00</li>
            <li class="dt-hour">11:00</li>
            <li class="dt-hour">12:00</li>
            <li class="dt-hour">13:00</li>
            <li class="dt-hour">14:00</li>
            <li class="dt-hour">15:00</li>
            <li class="dt-hour">16:00</li>
            <li class="dt-hour">17:00</li>
            <li class="dt-hour">18:00</li>
            <li class="dt-hour">19:00</li>
            <li class="dt-hour">20:00</li>
            <li class="dt-hour">21:00</li>
        </ul>
    </section>
    <footer class="dt-footer clearfix">
        <div class="dt-sec">您已选择：<span class="sec-date">01/19</span> <span class="sec-text">09:00</span></div>
        <button>确认下单</button>
    </footer>

    <script> 	
      	// 获取本地时间
    		var myDate = new Date();

      	var baseMonthsDay = [31,28,31,30,31,30,31,31,30,31,30,31]; //各月天数
      	var thisYear  = myDate.getFullYear();        //年
        var thisMonth  = myDate.getMonth();     	   //月
        var thisDay  = myDate.getDate();            //日
        var thisWeek = myDate.getDay();              //周
        var thisHour = myDate.getHours(); 			        //小时
       	var thisMonthDays = [];//这个月有多少天
        var addMonthDays = [1, 2, 3, 4, 5, 6]; //增加月末天数数组
        var addMonth = $(".dt-month"); //获取月对象
        var addDays = $(".dt-day"); //获取天数对象
        var getCurHour = $(".dt-hour"); 
        var dtMainContent = '<ul class="clearfix"><li class="dt-hour dt-hour-click hour-act">09:00</li><li class="dt-hour dt-hour-click">10:00</li><li class="dt-hour dt-hour-click">11:00</li><li class="dt-hour dt-hour-click">12:00</li><li class="dt-hour dt-hour-click">13:00</li><li class="dt-hour dt-hour-click">14:00</li><li class="dt-hour dt-hour-click">15:00</li><li class="dt-hour dt-hour-click">16:00</li><li class="dt-hour dt-hour-click">17:00</li><li class="dt-hour dt-hour-click">18:00</li><li class="dt-hour dt-hour-click">19:00</li><li class="dt-hour dt-hour-click">20:00</li><li class="dt-hour dt-hour-click">21:00</li></ul>';

        console.log(thisYear , thisMonth , thisDay , thisWeek);
        

        function getDaysOfEveryMonth(){
	        //判断闰年
     			function isRunYear(fullYear){
      			return (fullYear % 4 == 0 && (fullYear % 100 != 0 || fullYear % 400 == 0));
    			}
    			//传天数，返回天数数组
    			function getThisMonthDays(days){
       			var arr = [];
       			for(var i=1;i <= days;i++){
         				arr.push(i);
      			}
      			return arr;
    			}
			    //闰年2月29天
  		 	  if(isRunYear(thisYear) && thisMonth == 1){
      			thisMonthDays = getThisMonthDays(baseMonthsDay[thisMonth] + 1);
    			}else{
      			thisMonthDays = getThisMonthDays(baseMonthsDay[thisMonth]);
    			}
          console.log(thisMonthDays);
        }
        
        // 获取周
        function getWeek(){
          var weekArr = ['日', '一', '二', '三', '四', '五', '六', '日', '一', '二', '三'];
          var getWeekObj = $(".dt-week");
          switch (thisWeek){
            case 0:
              for(let i = 0; i < getWeekObj.length; i++){
                getWeekObj.eq(i).text(weekArr[i])
              }  
            break;
            case 1: 
              for(let i = 0; i < getWeekObj.length; i++){
                getWeekObj.eq(i).text(weekArr[i+1])
              }
            break;
            case 2: 
              for(let i = 0; i < getWeekObj.length; i++){
                getWeekObj.eq(i).text(weekArr[i+2])
              }
            break;
            case 3: 
              for(let i = 0; i < getWeekObj.length; i++){
                getWeekObj.eq(i).text(weekArr[i+3])
              }
            break;
            case 4: 
              for(let i = 0; i < getWeekObj.length; i++){
                getWeekObj.eq(i).text(weekArr[i+4])
              }
            break;
            case 5: 
              for(let i = 0; i < getWeekObj.length; i++){
                getWeekObj.eq(i).text(weekArr[i+5])
              }
            break;
            case 6: 
              for(let i = 0; i < getWeekObj.length; i++){
                getWeekObj.eq(i).text(weekArr[i+6])
              }
            break;
          }
        }

        // 判断月末&增加天数
        function monthEnd(){
          let thisMonthDaysLength = thisMonthDays.length;
          let thisMonthDaysNew = thisMonthDays.concat(addMonthDays);

          // 增加天数
          var sc = $(".dt-day");
          for(let i = 0; i < sc.length; i++){
            if (thisMonthDaysNew[(thisDay-1)+i] > 0 && thisMonthDaysNew[(thisDay-1)+i] < 10) {
              sc.eq(i).text("0"+thisMonthDaysNew[(thisDay-1)+i])
            }else{
              sc.eq(i).text(thisMonthDaysNew[(thisDay-1)+i])
            }
          }
          // 增加月
          for(let i = 0; i < addMonth.length; i++){
            if (thisMonth < 9 && thisMonth >= 0) {
              addMonth.eq(i).text("0"+(thisMonth+1))
            }else{
              addMonth.eq(i).text((thisMonth+1))
            }
          }

          // 判断月末
          switch(thisMonthDaysLength){
            case 28: // 平年2月
              checkMonthToggle(28)
            break;
            case 29: // 闰年2月
              checkMonthToggle(29)
            break;
            case 30: // 4,6,9,11
              checkMonthToggle(30)
            break;
            case 31: // 1,3,5,7,8
              checkMonthToggle(31)
            break;
          }
        }
        // 获取月末最后一天的排列数
        function checkDay(cont){
          for(let i = 0; i < addDays.length; i++){
            if (addDays.eq(i).text() == cont) {
              return (i+1);
            }
          }
        }

        // 月末月初切换
        function checkMonthToggle(num){
          var m = checkDay(num);
          var k = parseInt(addMonth.eq(m).text());
          for(let s = m; s < addMonth.length; s++){
            if (k < 9 && k >= 0) {
              addMonth.eq(s).text("0"+(k+1))
            }else{
              addMonth.eq(s).text(k+1)
            }
          }
        }
        // 判断时间及不可点击状态
        function checkCurrentTime() {
          var getHourLength = getCurHour.length;
          for(let i = 0; i < getHourLength; i++){
            var getCurrent = parseInt(getCurHour.eq(i).text().slice(0,2));
            if (getCurrent > (thisHour+1)) {
              getCurHour.eq(i).removeClass().addClass("dt-hour dt-hour-click")
            }else if(getCurrent < (thisHour+1)){
              getCurHour.eq(i).removeClass().addClass("dt-hour dt-hour-disabled")
            }else{
              getCurHour.eq(i).removeClass().addClass("dt-hour dt-hour-click hour-act")
            }
          }
        }


		    getDaysOfEveryMonth()
        getWeek()// 获取周
        monthEnd() // 判断月末&增加天数
        checkCurrentTime() // 判断时间及不可点击状态


        $(function(){
	        $(".dt-header").on('tap',".dt-tg",function(){
	        	$(this).addClass("tg-act").siblings().removeClass("tg-act");
	        	var spanTxt = $(this).find('span').eq(0).text().replace(/-/,"/");
	        	$(".sec-date").text(spanTxt);
	        })

          $(".dt-header").on('tap',".dt-tg-ont",function(){
            window.location.reload()
          })

          $(".dt-header").on('tap',".dt-tg-append",function(){
            $(".dt-main").empty().append(dtMainContent)
          })

	        $(".dt-main").on('tap',".dt-hour-click",function(){
	        	$(this).addClass("hour-act").siblings().removeClass("hour-act");
	        	$(".sec-text").text($(this).text());
	        })

          $(".dt-footer").on("tap","button",function(){
            alert($(".dt-sec").text())
          })

          // 获取第一个日期
          var spanFirst = $(".tg-act").find('span').eq(0).text().replace(/-/,"/");
          $(".sec-date").text(spanFirst)
        })

    </script>
</body>
</html>